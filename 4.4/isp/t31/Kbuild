SRCS := $(DIR)/tx-isp-debug.c \
        $(DIR)/tx-isp-module.c

# Paths
WRAPPER_C := $(DIR)/wrapper.c
WRAPPER_O := $(DIR)/wrapper.o
LIBWRAPPER := $(DIR)/libwrapper.a

# Compile the wrapper source file into an object file
$(WRAPPER_O): $(WRAPPER_C)
	$(CC) -c $< -o $@

# Archive the wrapper object into a static library
$(LIBWRAPPER): $(WRAPPER_O)
	$(AR) rcs $@ $<

# Object files for your original source files
OBJS := $(SRCS:%.c=%.o) $(ASM_SRCS:%.S=%.o)

# List of libraries to link against
OUT_OBJS := $(LIBWRAPPER) $(KERNEL_VERSION)/sdk/lib$(SOC_FAMILY)-firmware.a

# Combine all objects into a single module
$(OUT)-objs := $(OBJS) $(OUT_OBJS)

# Define the module target
obj-m += $(OUT).o

# Make sure the wrapper is built before anything else
$(OBJS): $(LIBWRAPPER)
